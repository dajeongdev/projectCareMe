<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="doctorQuestionBrd">

<!-- 게시판 뿌리기 -->
	<select id="getArt" resultType="com.careme.model.dto.QuestionBoardDto">
		select * from question_board inner join members on question_board.member_idx=members.member_idx where question_type like 'y'
	</select>
	
	<select id="getArtContent" resultType="com.careme.model.dto.QuestionBoardDto" parameterType="com.careme.model.dto.QuestionBoardDto">
		select * from question_board inner join members on question_board.member_idx=members.member_idx where question_table_idx=#{question_table_idx}
	</select>
	
	<update id="getArtView" parameterType="com.careme.model.dto.QuestionBoardDto">
		update question_board set 
			view_count=view_count+1 
			where question_table_idx=#{question_table_idx}
	</update>

	<select id="getArtComments" resultType="com.careme.model.dto.BoardCommentDto" parameterType="int">
		select * from question_board_comment inner join members on question_board_comment.member_idx=members.member_idx where question_table_idx=#{question_table_idx} 
	</select>
	
	<select id="getCommentCount" resultType="int" parameterType="int">
		select count(*) from question_baord_comment inner join member on question_board_comment.member_idx=members.member_idx where question_table_idx=#{question_table_idx}
	</select>
	

<!-- 게시판글 검색 -->
	<select id="getSrchArticle" resultType="com.careme.model.dto.QuestionBoardDto" parameterType="com.careme.model.command.SearchBoardCommand">
		select * from question_board natural join members
			<choose>
				<when test='search_option != null and search_option.equals("member_id")'>
					where member_id like concat('%',#{searchKeyword},'%')
				</when>
				<when test='search_option != null and search_option.equals("title")'>
					where title like concat('%',#{searchKeyword},'%')
				</when>
				<when test='search_option != null and search_option.equals("content")'>
					where content like concat('%',#{searchKeyword},'%')
				</when>
			</choose>
	</select>  

<!-- 게시판글 작성 수정 삭제 -->
	
	<select id="getSpec" resultType="com.careme.model.dto.QuestionBoardDto">
		select pet_species_idx from pet_species
	</select>
	
	<insert id="insertArt" parameterType="com.careme.model.dto.QuestionBoardDto">
		insert into question_board (member_idx, title, question_type, doctor_idx, pet_idx, pet_species_idx, content, view_count, is_private, reg_date, update_date, del_yn) 
		values (#{member_idx}, #{title}, #{question_type}, #{doctor_idx}, #{pet_idx}, #{pet_species_idx}, #{content}, 0, #{is_private}, #{reg_date}, null, 'n')
	</insert>
	
    <update id="updateArticle" parameterType="com.careme.model.dto.QuestionBoardDto">
		update question_board set title=#{title}, content=#{content}, pet_species_idx=#{pet_species_idx}, 
		doctor_idx=#{doctor_idx}, is_private=#{is_private}, pet_idx=#{pet_idx}, update_date=#{update_date} where question_table_idx=#{question_table_idx}
	</update>

	<delete id="deleteArticle" parameterType="int">
		delete from question_board where question_table_idx=#{question_table_idx}
	</delete>
</mapper>